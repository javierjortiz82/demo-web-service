# Demo Agent Environment Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# Database Configuration
# =============================================================================
DATABASE_URL=postgresql://mcp_user:mcp_password@localhost:5434/mcpdb
SCHEMA_NAME=test

# =============================================================================
# Google Cloud / Vertex AI Configuration (REQ-1: Gemini 2.5 via Vertex AI SDK)
# =============================================================================
GCP_PROJECT_ID=your-gcp-project-id
GCP_LOCATION=us-central1

# Service Account Authentication (Recommended for production)
# Path to your Google Cloud service account JSON file
# Download from: GCP Console > IAM & Admin > Service Accounts > Keys > Add Key > JSON
# Required role: Vertex AI User (roles/aiplatform.user)
GOOGLE_APPLICATION_CREDENTIALS=credentials/google-sa.json

# Alternative: Direct Gemini API Key (Development only - not recommended)
# GOOGLE_API_KEY=AIza...

# Model Configuration
MODEL=gemini-2.5-flash
TEMPERATURE=0.2
MAX_OUTPUT_TOKENS=2048

# =============================================================================
# Demo Limits Configuration
# =============================================================================
DEMO_MAX_TOKENS=5000
DEMO_COOLDOWN_HOURS=24
DEMO_WARNING_THRESHOLD=85

# =============================================================================
# Server Configuration
# =============================================================================
DEMO_AGENT_HOST=0.0.0.0
DEMO_AGENT_PORT=8082

# =============================================================================
# Security Configuration
# =============================================================================
ENABLE_FINGERPRINT=true
FINGERPRINT_SCORE_THRESHOLD=0.7

# =============================================================================
# Clerk Authentication Configuration
# =============================================================================
CLERK_SECRET_KEY=sk_test_...
CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_WEBHOOK_SECRET=whsec_...
CLERK_FRONTEND_API=clerk.accounts.dev
ENABLE_CLERK_AUTH=true

# =============================================================================
# CORS Configuration
# =============================================================================
CORS_ALLOW_ORIGINS=http://localhost:8080,http://localhost:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=*
CORS_ALLOW_HEADERS=*

# =============================================================================
# Rate Limiting Configuration
# =============================================================================
IP_RATE_LIMIT_REQUESTS=100
IP_RATE_LIMIT_WINDOW_SEC=60

# =============================================================================
# Concurrency Configuration
# =============================================================================
# UVICORN_WORKERS
# Description: Number of Uvicorn worker processes.
# Type:        Integer
# Default:     4
# Constraints: Must be between 1 and 32
# Note:        Each worker runs independently with its own memory space.
#              Recommended: 2-4 for most deployments, up to CPU cores for high load.
# Example:     UVICORN_WORKERS=4
UVICORN_WORKERS=4

# MAX_CONCURRENT_REQUESTS
# Description: Maximum number of concurrent Gemini API calls per worker.
# Type:        Integer
# Default:     10
# Constraints: Must be between 1 and 100
# Note:        Controls the ThreadPoolExecutor size for non-blocking API calls.
#              Requests beyond this limit will wait in queue until a slot is available.
# Calculation: Total concurrent = UVICORN_WORKERS × MAX_CONCURRENT_REQUESTS
#              Example: 4 workers × 10 = 40 max concurrent Gemini API calls
# Example:     MAX_CONCURRENT_REQUESTS=10
MAX_CONCURRENT_REQUESTS=10

# =============================================================================
# Database Pool Configuration
# =============================================================================
# DB_POOL_MIN_SIZE
# Description: Minimum number of database connections to keep in the pool per worker.
# Type:        Integer
# Default:     5
# Constraints: Must be between 1 and 50
# Note:        These connections are pre-established and ready for immediate use.
#              Higher values reduce connection latency but use more resources.
# Example:     DB_POOL_MIN_SIZE=5
DB_POOL_MIN_SIZE=5

# DB_POOL_MAX_SIZE
# Description: Maximum number of database connections allowed in the pool per worker.
# Type:        Integer
# Default:     20
# Constraints: Must be between 1 and 100
# Note:        Total DB connections = UVICORN_WORKERS × DB_POOL_MAX_SIZE
#              Example: 4 workers × 20 = 80 max database connections
#              Ensure PostgreSQL max_connections >= total + overhead (superuser, replication)
# Example:     DB_POOL_MAX_SIZE=20
DB_POOL_MAX_SIZE=20

# DB_COMMAND_TIMEOUT
# Description: Timeout in seconds for database queries.
# Type:        Integer
# Default:     60
# Constraints: Must be between 5 and 300
# Note:        Queries exceeding this timeout will be cancelled and raise an error.
# Example:     DB_COMMAND_TIMEOUT=60
DB_COMMAND_TIMEOUT=60

# =============================================================================
# Proxy & IP Extraction Configuration
# =============================================================================
TRUSTED_PROXIES=
ENABLE_PROXY_HEADERS=true
PROXY_DEPTH=1
USE_CLOUDFLARE=false

# =============================================================================
# Logging Configuration (structlog with rotation)
# =============================================================================
# Set LOG_LEVEL=DEBUG to enable debug mode and uvicorn auto-reload
LOG_LEVEL=INFO
LOG_TO_FILE=true
LOG_DIR=logs
LOG_CONSOLE_ENABLED=true
LOG_JSON_FORMAT=true
LOG_FILE_MAX_MB=10
LOG_FILE_BACKUP_COUNT=5
