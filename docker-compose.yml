services:
  demo-agent:
    build: .
    container_name: demo-agent
    user: "${DOCKER_UID:-1000}:${DOCKER_GID:-1000}"
    env_file: .env
    ports:
      - "${DEMO_AGENT_PORT:-9090}:${DEMO_AGENT_PORT:-9090}"
    volumes:
      - ./app:/app/app
      - ./credentials:/app/credentials
      - ./prompts:/app/prompts
    environment:
      - PYTHONUNBUFFERED=1
      - DEMO_AGENT_HOST=0.0.0.0
      - DEMO_AGENT_PORT=${DEMO_AGENT_PORT:-9090}
      - LOG_DIR=/app/logs
      - GOOGLE_APPLICATION_CREDENTIALS=/app/credentials/google-sa.json
      - GCP_PROJECT_ID=${GCP_PROJECT_ID}
      - GCP_LOCATION=${GCP_LOCATION:-us-central1}
      - MODEL=${MODEL:-gemini-2.5-flash}
      - DATABASE_URL=${DATABASE_URL}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${DEMO_AGENT_PORT:-9090}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    command: uvicorn app.main:app --host 0.0.0.0 --port ${DEMO_AGENT_PORT:-9090} --workers ${UVICORN_WORKERS:-2}
    networks:
      - docker-config

networks:
  docker-config:
    external: true
